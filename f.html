<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Annuaire Partenaires | BinaaCompare</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #e67e22;
            --secondary: #1a2b3c;
            --bg-light: #f4f7fa;
            --glass: rgba(255, 255, 255, 0.9);
        }

        body { 
            font-family: 'Poppins', sans-serif; 
            background-color: var(--bg-light); 
            margin: 0; 
            overflow-x: hidden;
            position: relative;
        }

        /* --- خلفية الأيقونات المتحركة --- */
        .bg-animated {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; opacity: 0.05; pointer-events: none;
        }
        .bg-animated i {
            position: absolute; color: var(--secondary);
            animation: move linear infinite;
        }
        @keyframes move {
            from { transform: translateY(100vh) rotate(0deg); }
            to { transform: translateY(-10vh) rotate(360deg); }
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; position: relative; }

        /* --- Navbar --- */
        .navbar { background: var(--glass); backdrop-filter: blur(10px); padding: 15px 0; sticky: top; z-index: 100; border-bottom: 1px solid rgba(0,0,0,0.05); }
        .logo { font-size: 1.5rem; font-weight: 800; color: var(--secondary); text-decoration: none; }
        .logo span { color: var(--primary); }

        /* --- Search & Header --- */
        .hero-section { padding: 60px 0 40px; text-align: center; }
        .hero-section h1 { font-size: 2.5rem; color: var(--secondary); margin-bottom: 10px; font-weight: 700; }
        
        .search-box-container {
            max-width: 600px; margin: 30px auto; position: relative;
        }
        .search-input {
            width: 100%; padding: 18px 25px 18px 55px; border-radius: 50px;
            border: none; box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            font-size: 1rem; outline: none; transition: 0.3s;
        }
        .search-input:focus { box-shadow: 0 10px 30px rgba(230, 126, 34, 0.2); }
        .search-box-container i { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: var(--primary); font-size: 1.2rem; }

        .filter-pills { 
            display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; margin-bottom: 40px;
        }
        .pill { 
            padding: 10px 22px; background: white; border-radius: 50px; cursor: pointer;
            font-size: 0.9rem; font-weight: 500; transition: 0.3s; box-shadow: 0 4px 10px rgba(0,0,0,0.03);
            border: 1px solid transparent;
        }
        .pill.active { background: var(--primary); color: white; transform: scale(1.05); }
        .pill:hover:not(.active) { border-color: var(--primary); color: var(--primary); }

        /* --- Grid & Cards --- */
        .suppliers-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); 
            gap: 25px; padding-bottom: 60px;
        }

        .supplier-card {
            background: white; border-radius: 20px; padding: 25px;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative; border: 1px solid rgba(0,0,0,0.02);
            box-shadow: 0 5px 15px rgba(0,0,0,0.02);
            display: flex; flex-direction: column;
        }
        .supplier-card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,0.08); }

        .card-header { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; }
        .comp-logo { 
            width: 60px; height: 60px; border-radius: 15px; background: #f8f9fa;
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; color: var(--primary); font-size: 1.4rem; border: 1px solid #eee;
        }
        .comp-city { margin-left: auto; font-size: 0.7rem; background: #e8f4fd; color: #2980b9; padding: 5px 12px; border-radius: 20px; font-weight: 700; text-transform: uppercase; }

        .card-body h3 { margin: 0; color: var(--secondary); font-size: 1.2rem; }
        .ice-text { font-size: 0.8rem; color: #95a5a6; margin-bottom: 15px; display: block; }
        
        .contact-info { background: #fcfcfc; border-radius: 12px; padding: 12px; margin-bottom: 20px; }
        .contact-info p { margin: 5px 0; font-size: 0.85rem; color: #555; display: flex; align-items: center; gap: 8px; }
        .contact-info i { color: var(--primary); width: 15px; }

        .btn-view {
            margin-top: auto; width: 100%; padding: 12px; border-radius: 12px;
            background: var(--secondary); color: white; text-decoration: none;
            text-align: center; font-weight: 600; font-size: 0.9rem; transition: 0.3s;
        }
        .btn-view:hover { background: var(--primary); }

        #noResult { text-align: center; grid-column: 1/-1; padding: 40px; display: none; }
    </style>
</head>
<body>

    <div class="bg-animated" id="bgIcons"></div>

    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">Binaa<span>Compare</span></a>
        </div>
    </nav>

    <div class="container">
        <section class="hero-section">
            <h1>Nos Partenaires de Confiance</h1>
            <p style="color:#7f8c8d">Trouvez les meilleurs fournisseurs et professionnels du bâtiment au Maroc</p>
            
            <div class="search-box-container">
                <i class="fas fa-search"></i>
                <input type="text" class="search-input" id="searchInput" placeholder="Rechercher par nom, ville ou ICE...">
            </div>

            <div class="filter-pills" id="cityFilters">
                <span class="pill active" data-city="all">Tous le Maroc</span>
                <span class="pill" data-city="Casablanca">Casablanca</span>
                <span class="pill" data-city="Tanger">Tanger</span>
                <span class="pill" data-city="Rabat">Rabat</span>
                <span class="pill" data-city="Marrakech">Marrakech</span>
                <span class="pill" data-city="Agadir">Agadir</span>
            </div>
        </section>

        <main class="suppliers-grid" id="suppliersGrid">
            </main>
        
        <div id="noResult">
            <i class="fas fa-search-minus fa-3x" style="color:#ccc; margin-bottom:15px"></i>
            <p>Aucun partenaire ne correspond à votre recherche.</p>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB6WrsIzfsCCHMZmBkPzLQK2csKveaxY4U",
            authDomain: "binaacompare-fa5e1.firebaseapp.com",
            projectId: "binaacompare-fa5e1",
            storageBucket: "binaacompare-fa5e1.firebasestorage.app",
            appId: "1:667570543544:web:652218ab5a773eb2154d4d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- توليد الأيقونات المتحركة في الخلفية ---
        const icons = ['fa-hammer', 'fa-trowel', 'fa-compass-drafting', 'fa-helmet-safety', 'fa-ruler-combined', 'fa-building'];
        const bgContainer = document.getElementById('bgIcons');
        for(let i=0; i<20; i++) {
            const icon = document.createElement('i');
            icon.className = `fas ${icons[Math.floor(Math.random()*icons.length)]}`;
            icon.style.left = Math.random() * 100 + 'vw';
            icon.style.animationDuration = (Math.random() * 10 + 10) + 's';
            icon.style.fontSize = (Math.random() * 20 + 20) + 'px';
            icon.style.animationDelay = (Math.random() * 5) + 's';
            bgContainer.appendChild(icon);
        }

        let allVendors = [];
        const grid = document.getElementById('suppliersGrid');
        const searchInput = document.getElementById('searchInput');

        // جلب البيانات من Firebase
        async function fetchVendors() {
            grid.innerHTML = '<div style="grid-column:1/-1; text-align:center;"><i class="fas fa-circle-notch fa-spin fa-2x" style="color:var(--primary)"></i></div>';
            const q = query(collection(db, "users"), where("role", "==", "vendor"));
            const snapshot = await getDocs(q);
            allVendors = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderVendors(allVendors);
        }

        // عرض البيانات مع الفلترة والبحث
        function renderVendors(vendors) {
            grid.innerHTML = '';
            const cityActive = document.querySelector('.pill.active').dataset.city;
            const searchText = searchInput.value.toLowerCase();

            const filtered = vendors.filter(v => {
                const matchesCity = (cityActive === 'all' || v.city === cityActive);
                const matchesSearch = v.companyName.toLowerCase().includes(searchText) || 
                                     (v.city && v.city.toLowerCase().includes(searchText)) ||
                                     (v.ice && v.ice.includes(searchText));
                return matchesCity && matchesSearch;
            });

            if(filtered.length === 0) {
                document.getElementById('noResult').style.display = 'block';
            } else {
                document.getElementById('noResult').style.display = 'none';
                filtered.forEach(data => {
                    const card = document.createElement('div');
                    card.className = 'supplier-card';
                    
                    const logoHtml = (data.profilePic && data.profilePic !== "default") 
                        ? `<img src="${data.profilePic}" class="comp-logo" style="object-fit:cover;">`
                        : `<div class="comp-logo">${data.companyName.charAt(0).toUpperCase()}</div>`;

                    card.innerHTML = `
                        <div class="card-header">
                            ${logoHtml}
                            <span class="comp-city">${data.city || 'Maroc'}</span>
                        </div>
                        <div class="card-body">
                            <h3>${data.companyName}</h3>
                            <span class="ice-text">ICE: ${data.ice || '---'}</span>
                            <div class="contact-info">
                                <p><i class="fas fa-user-tie"></i> ${data.firstName} ${data.lastName}</p>
                                <p><i class="fas fa-phone"></i> ${data.phone || 'Non spécifié'}</p>
                            </div>
                        </div>
                        <a href="fpro.html?id=${data.id}" class="btn-view">Voir le profil</a>
                    `;
                    grid.appendChild(card);
                });
            }
        }

        // أحداث البحث
        searchInput.addEventListener('input', () => renderVendors(allVendors));

        // أحداث الفلترة بالمدن
        document.querySelectorAll('.pill').forEach(pill => {
            pill.onclick = (e) => {
                document.querySelector('.pill.active').classList.remove('active');
                e.target.classList.add('active');
                renderVendors(allVendors);
            };
        });

        fetchVendors();
    </script>
</body>
</html>